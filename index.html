<!DOCTYPE html>
<html lang="en">
    <head>
		
        <meta charset="utf-8">
        <meta name="viewport" content="width=100%, initial-scale=1">
        <title>老姐和孟孟的聊天</title>
        <link href="css/main.min.css" rel="stylesheet" type="text/css">
        <link rel="Shortcut Icon" href="favicon.ico"/>
    </head>
    <body>
    	
    	<!-- 音乐播放器（默认不显示） -->
        <audio id="bgm"  autoplay loop >
        	<source src="music/jiejie.mp3" type="audio/mpeg">
                       您的浏览器不支持音频播放。
		</audio>
        <div id="mobile" :class="{ 'has-prompt': hasPrompt }">
            <div id="mobile-head">
                <div id="mobile-head-title">老姐和孟孟的聊天</div>
            </div>
            <div id="mobile-body">
                <div id="mobile-body-bg"></div>
                <div id="mobile-body-content">
                    <div id="mock-msg-row" class="msg-row">
                        <div id="mock-msg" class="msg" v-html="latestMsgContent"></div>
                    </div>
                    <div class="msg-row"
                        v-for="(msg, index) in messages"
                        :key="index"
                        :class="msg.author === 'author' ? 'msg-author' : 'msg-me'">
                        <div class="msg"
                            :class="'msg-bounce-in-' + (msg.author === 'author' ? 'left': 'right')"
                            :style="msg.width && msg.height && {width: msg.width - 26 + 'px', height: msg.height - 18 + 'px'}"
                            v-html="msg.content"></div>
                    </div>
                </div>
            </div>
          
            <div id="mobile-foot">
                <div id="prompt">
                    <div id="prompt-head">
                        <div class="say-something">我想说……</div>
                        <a href="javascript:;" class="close-btn"
                            v-on:click="togglePrompt(false)"></a>
                    </div>
                    <div id="prompt-body">
                        <ul class="responses" v-if="lastDialog">
                            <li v-for="res in lastDialog.responses">
                                <a href="javascript:;" v-on:click="respond(res)">{{ res.content }}</a>
                            </li>
                        </ul>
                        <div class="next-topic"
                            v-if="!lastDialog || !lastDialog.responses">
                            <ul class="topics">
                                <li v-for="topic in nextTopics">
                                    <a href="javascript:;" v-on:click="ask(topic)">{{ topic.brief }}</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div id="input-hint" class="say-something"
                    v-on:click="togglePrompt(true)"
                    :class="{'clickable': !isTyping }">
                    <span v-if="!isTyping">我想说……</span>
                    <span v-if="isTyping">孟孟正在输入中</span>
                </div>
            </div>
            <div id="prompt-bg" v-on:click="togglePrompt(false)"></div>
        </div>

        <div class="extra-link" id="meta-link">
            <a class="letters" href="https://github.com/wongjohn/for-my-love" target="_blank">
                源码
            </a>
        </div>

	   
        
        
        <script src="https://cdn.jsdelivr.net/npm/zepto@1.2.0/dist/zepto.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vue@2.2.6/dist/vue.min.js"></script>
        <script src="js/index-min.js"></script>
        
        
        <!-- ✅ 播放控制脚本放在 body 最底部 -->
		<script>
			  // 页面加载时尝试自动播放
			  window.addEventListener('load', () => {
			    const audio = document.getElementById('bgm');
			    audio.play().catch(() => {
			      console.log("自动播放失败，等待用户点击触发");
			    });
			  });
			
			  // 用户点击页面任意位置触发播放（移动端兼容）
			
			 
			  
			  document.body.addEventListener('click', (event) => {
				  const audio = document.getElementById('bgm');
				
				  // ✅ 如果点击的是视频遮罩层或其子元素，则不播放 bgm
				  const overlay = document.getElementById('final-video-overlay');
				  if (overlay.contains(event.target)) {
				    return; // ✅ 直接退出，不播放 bgm
				  }
				
				  if (audio.dataset.locked !== "true") {
				    audio.play();
				  }
				});


			
			  // ✅ 视频播放完显示文字和按钮（不要嵌套在点击事件里）
			  document.addEventListener('DOMContentLoaded', function () {
				  const finalVideo = document.getElementById('final-video');
				  const finalMessage = document.getElementById('final-message');
				  const exitBtn = document.getElementById('exit-btn');
				  const overlay = document.getElementById('final-video-overlay');
				
				  // ✅ 视频播放完后显示文字和按钮
				 finalVideo.addEventListener('ended', function () {
					  console.log("✅ 视频播放完毕，显示文字和按钮");
					  finalMessage.style.display = 'block';
					  overlay.style.pointerEvents = 'auto';
					
					  const bgm = document.getElementById('bgm');
					  if (bgm) {
					    bgm.dataset.locked = "false"; // ✅ 解锁
					    bgm.play(); // ✅ 恢复播放
					  }
				});

				
				  // ✅ 点击按钮后尝试关闭页面
				  exitBtn.addEventListener('click', function () {
				    console.log("✅ 用户点击了结束按钮，尝试关闭页面");
				    window.close(); // 尝试关闭标签页
				    // ✅ 兜底：如果关闭失败，隐藏遮罩层
				    overlay.style.display = 'none';
				  });
				});

			</script>

		<!-- ✅ 结尾视频遮罩层 -->
		<div id="final-video-overlay" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;z-index:9999;background:black;">
		  <video id="final-video" width="100%" height="100%"  playsinline >
		    <source src="video/kuajiejie.mp4" type="video/mp4">
		    您的浏览器不支持视频播放。
		  </video>
		    <!-- ✅ 视频播放完后显示的文字和按钮 -->
				  <div id="final-message" style="
				    display: none;
				    position: absolute;
				    top: 50%;
				    left: 50%;
				    transform: translate(-50%, -50%);
				    text-align: center;
				    color: white;
				    z-index: 10000;
				  ">
				   <p style="font-size: 18px; margin-bottom: 16px;">愿这份心意，永远留在你心里。</p>
						<button id="exit-btn" style="
						  padding: 10px 20px;
						  font-size: 16px;
						  background-color: #ff69b4;
						  color: white;
						  border: none;
						  border-radius: 6px;
						  cursor: pointer;
						">点击结束</button>

				  </div>

		</div>
 
    </body>
</html>
